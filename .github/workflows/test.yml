name: Test rubocop and brakeman
on:
  push:
  pull_request:
   branches:
     - test 
jobs:
  test_rubocop:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: ruby/setup-ruby@v1
        with:
          ruby-version: 3.0.3 # Not needed with a .ruby-version file
      - name: Pre test
        run: |
          mkdir .apt && mkdir /var/cache/apt/archives && mount --bind .apt /var/cache/apt/archives/
          apt-get update -qq &&
          apt-get install -y apt-utils build-essential nodejs default-libmysqlclient-dev && 
          apt-get clean && 
          rm -rf /var/lib/apt/lists/*
      - name: rubocop
        run: bundle exec rubocop
      
  test_brakeman:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: ruby/setup-ruby@v1
        with:
          ruby-version: 3.0.3
      - name: Pre test
        run: |
          mkdir .apt && mkdir /var/cache/apt/archives && mount --bind .apt /var/cache/apt/archives/
          apt-get update -qq &&
          apt-get install -y apt-utils build-essential nodejs default-libmysqlclient-dev && 
          apt-get clean && 
          rm -rf /var/lib/apt/lists/*
      - name: Brakeman action
        uses: artplan1/brakeman-action@v1.2.1
        with:
          flags: "--color"
